<!doctype html>
<html lang="sv">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="data:/" type="image/x-icon" />
    <title>Najs frontend</title>
  </head>
  <body>
    <header>
      <h2>Najs frontend</h2>
    </header>
    <main>
      <form>
        <label>Port:<input id="port" type="number" value="3007" /></label>
        <label>Endpoint:<input id="endpoint" value="products" /></label>
        <button id="getBtn" type="submit">GET</button>

        <label
          >Search:<input id="searchField" type="search" name="search"
        /></label>
        <button id="searchBtn" type="submit">Sök</button>
      </form>
      <h3>Data laddad från backend:</h3>

      <table id="table"></table>
    </main>
    <footer>
      <p>
        &copy; 2026 Najs frontendprojekt.
        <b><i>Upphovsrättsbrott beivras ej.</i></b>
      </p>
    </footer>
    <script>
      const renderTable = (data) => {
        table.innerHTML =
          `<tr>${Object.keys(data[0]).map((name) => `<td><b>${name}</b></td>`)
            .join``}</tr>` +
          data.map(
            (row) =>
              `<tr>${Object.values(row).map((col) => `<td>${col}</td>`)
                .join``}</tr>`,
          ).join``;
      };
      getBtn.addEventListener("click", async () => {
        data = await fetch(
          `http://localhost:${port.value}/${endpoint.value}`,
        ).then((res) => res.json());
        renderTable(data);
      });
      searchField.addEventListener("input", async () => {
        data = await fetch(
          `http://localhost:${port.value}/${endpoint.value}?search=${searchField.value}`,
        ).then((res) => res.json());
        renderTable(data);
      });
      // Används/funkar ej
      /* searchBtn.addEventListener("submit", async (event???) => {
               data = await fetch(
                 `http://localhost:${port.value}/products?search=${searchField.value}`,
               ).then((res) => res.json());
               table.innerHTML =
                 `<tr>${Object.keys(data[0]).map((name) => `<td><b>${name}</b></td>`)
                   .join``}</tr>` +
                 data.map(
                   (row) =>
                     `<tr>${Object.values(row).map((col) => `<td>${col}</td>`)
                       .join``}</tr>`,
                 ).join``;
             }); */

      /* console.log(searchField.value);
             console.log(port.value);
             console.log(endpoint.value);
             console.log(data); */

      /* searchForm.addEventListener("submit", (event) => {
             if (searchField.value.length < 5) {
               // IMPORTANT: Stop the form from actually submitting/reloading the page
               event.preventDefault();
               alert("Please fix the errors before submitting!");
             } else {
               alert("Form submitted successfully!");
             }
           }); */

      /*
                 const renderTable = (data) => {
                   table.innerHTML =
                     `<tr>${Object.keys(data[0]).map((name) => `<td><b>${name}</b></td>`)
                       .join``}</tr>` +
                     data.map(
                       (row) =>
                         `<tr>${Object.values(row).map((col) => `<td>${col}</td>`)
                           .join``}</tr>`,
                     ).join``;
                 };
                 if (searchField.value.length > 0) {
                   data = await fetch(
                     `http://localhost:${port.value}/${endpoint.value}?search=${searchField.value}`,
                   ).then((res) => res.json());
                 }
                   else {
                     data = await fetch(
                       `http://localhost:${port.value}/${endpoint.value}`,
                     ).then((res) => res.json());
                 }
                 getBtn.addEventListener("click", async () => {
                   renderTable(data);
                 });
                 searchField.addEventListener("input", async () => {
                   renderTable(data);
                 });

           /*       getBtn.addEventListener("click", async () => {
                   data = await fetch(
                     `http://localhost:${port.value}/${endpoint.value}`,
                   ).then((res) => res.json());
                   renderTable(data);
                 });
                 searchField.addEventListener("input", async () => {
                   data = await fetch(
                     `http://localhost:${port.value}/${endpoint.value}?search=${searchField.value}`,
                   ).then((res) => res.json());
                   renderTable(data);
                 });
            */
    </script>
  </body>
</html>
